<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Challenge_05 Create a Pull Request validation workflow | Infrastructure as Code Basics</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/iac-basics-workshop/assets/css/0.styles.6d1f95f5.css" as="style"><link rel="preload" href="/iac-basics-workshop/assets/js/app.4b7700f7.js" as="script"><link rel="preload" href="/iac-basics-workshop/assets/js/2.4b56f390.js" as="script"><link rel="preload" href="/iac-basics-workshop/assets/js/3.65a53ed6.js" as="script"><link rel="prefetch" href="/iac-basics-workshop/assets/js/10.d38dce0b.js"><link rel="prefetch" href="/iac-basics-workshop/assets/js/11.a007f64a.js"><link rel="prefetch" href="/iac-basics-workshop/assets/js/12.0feb5ec5.js"><link rel="prefetch" href="/iac-basics-workshop/assets/js/13.2ad9f6bf.js"><link rel="prefetch" href="/iac-basics-workshop/assets/js/4.30920b48.js"><link rel="prefetch" href="/iac-basics-workshop/assets/js/5.d95be30f.js"><link rel="prefetch" href="/iac-basics-workshop/assets/js/6.908d09fa.js"><link rel="prefetch" href="/iac-basics-workshop/assets/js/7.c7c819d2.js"><link rel="prefetch" href="/iac-basics-workshop/assets/js/8.edf9252e.js"><link rel="prefetch" href="/iac-basics-workshop/assets/js/9.d56bb1c7.js">
    <link rel="stylesheet" href="/iac-basics-workshop/assets/css/0.styles.6d1f95f5.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/iac-basics-workshop/" class="home-link router-link-active"><!----> <span class="site-name">Infrastructure as Code Basics</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/azuredevcollege/iac-basics-workshop" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/azuredevcollege/iac-basics-workshop" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/iac-basics-workshop/" aria-current="page" class="sidebar-link">Home</a></li><li><a href="/iac-basics-workshop/challenges/challenge_00.html" class="sidebar-link">Setup your system</a></li><li><a href="/iac-basics-workshop/challenges/challenge_01.html" class="sidebar-link">Import the repository</a></li><li><a href="/iac-basics-workshop/challenges/challenge_02.html" class="sidebar-link">Git basics</a></li><li><a href="/iac-basics-workshop/challenges/challenge_03.html" class="sidebar-link">Create and deploy your first ARM Template</a></li><li><a href="/iac-basics-workshop/challenges/challenge_04.html" class="sidebar-link">Create a GitHub Workflow to deploy an ARM Template</a></li><li><a href="/iac-basics-workshop/challenges/challenge_05.html" aria-current="page" class="active sidebar-link">Deploy a Hub and Spoke Network</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/iac-basics-workshop/challenges/challenge_05.html#the-scenario" class="sidebar-link">The scenario</a></li><li class="sidebar-sub-header"><a href="/iac-basics-workshop/challenges/challenge_05.html#see-the-workflow-in-action" class="sidebar-link">See the workflow in action</a></li><li class="sidebar-sub-header"><a href="/iac-basics-workshop/challenges/challenge_05.html#congratulations" class="sidebar-link">Congratulations</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="challenge-05-create-a-pull-request-validation-workflow"><a href="#challenge-05-create-a-pull-request-validation-workflow" class="header-anchor">#</a> Challenge_05 Create a Pull Request validation workflow</h1> <p>In this challenge we will create a GitHub workflow that is used to validate a Pull Request.
If you work on a new feature or if you make changes to your production system, a best practice is to create a branch from your main branch and do all the work in the newly created branch before changes are merged back to the main branch. This strategy keeps your main branch clean and build breaks can be avoided. When you have finished your work you create a Pull Request to collaborate with other team members to review and discuss about the changes.</p> <h2 id="the-scenario"><a href="#the-scenario" class="header-anchor">#</a> The scenario</h2> <p>Let's say we want to roll out an Azure Storage account in a Resource Group using an ARM template. In order to ensure that we do not destroy anything in the production system, it would make sense to get feedback within the pull request which changes the ARM template would cause. Of course, we do not want to run this test against the production system. But since we have mapped the current state of the production system in the main branch, we can use the sources from the main branch to build a temporary environment. Once the temporary environment is created, we can run the test against that environment. To test the effect of an ARM template we use an ARM template deployment with the what-if option.</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token assign-left variable">CHANGES</span><span class="token operator">=</span>az deployment group what-if -n demo01 -g rg-name --template-file path/to/template --parameters <span class="token assign-left variable">param01</span><span class="token operator">=</span>value01
</code></pre></div><p>For better collaboration, it makes sense to map this procedure in a GitHub workflow and visualize the result of the what-if deployment directly in the pull request. This allows the team to discuss the possible changes.</p> <p>The GitHub Script action allows us to access GitHub resources like an issue and add a comment. You can find the documentation <a href="https://github.com/actions/github-script" target="_blank" rel="noopener noreferrer">here<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> on GitHub.</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/github<span class="token punctuation">-</span>script@v3
  <span class="token key atrule">with</span><span class="token punctuation">:</span> 
    <span class="token key atrule">github-token</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> github.token <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token key atrule">script</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
      github.issues.createComment({
        issue_number: ${{ github.event.number }},
        owner: context.repo.owner,
        repo: context.repo.repo,
        body: `your comment`
        })</span>

</code></pre></div><h3 id="the-flow-to-validate-an-arm-template-with-a-what-if-deployment-within-a-pull-request"><a href="#the-flow-to-validate-an-arm-template-with-a-what-if-deployment-within-a-pull-request" class="header-anchor">#</a> The flow to validate an ARM template with a what-if deployment within a Pull Request</h3> <p>The following diagram illustrates the what-if deployment process:</p> <p><img src="images/what-if-overview.png" alt="what-if overview"></p> <h3 id="deploy-to-a-staging-environment"><a href="#deploy-to-a-staging-environment" class="header-anchor">#</a> Deploy to a staging environment</h3> <p>At this point we can prepare an environment from the main branch and rollout our ARM template with the what-if option to see how the template would affect the environment.
This is a great way to already check what would happen. But this is not enough, because we also want to know how an environment looks like when we deploy the ARM template. That's why we extend our workflow to build a staging environment. This environment can then be tested, validated and it is a copy of the production system with the changes that the ARM template brings.
Again, the environment is first built from the main branch and then the ARM template is deployed from the branch. The GitHub script action is used to add a comment to the pull request describing the necessary information of the staging environment (e.g. name of the ResourceGroup).</p> <p><img src="images/staging-workfow.png" alt="staging-workflow"></p> <p>After the environment is provided we can take all measures to ensure the quality.</p> <h3 id="destroy-the-staging-environment"><a href="#destroy-the-staging-environment" class="header-anchor">#</a> Destroy the staging environment</h3> <p>If the staging environment meets our quality requirements, we can delete this environment again and take over the pull request.
Destroying the staging environment is easy. We just need to delete the ResourceGroup with a simple Azure CLI command:</p> <div class="language-shell extra-class"><pre class="language-shell"><code>az group delete -n rg-name -y
</code></pre></div><h3 id="unique-names-for-temporary-environments"><a href="#unique-names-for-temporary-environments" class="header-anchor">#</a> Unique names for temporary environments</h3> <p>When we create the name for our temporary environments, we need to make sure they are unique. Also, it would be useful to somehow associate the name with the name of the branch to which the pull request belongs. There is a GitHub action available which exposes short values of some GitHub environment variables inside a GitHub workflow.
The documentation of the GitHub Slug action can be found <a href="https://github.com/rlespinasse/github-slug-action" target="_blank" rel="noopener noreferrer">here<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.
The action injects the <strong>GITHUB_HEAD_REF_SLUG_URL</strong> environment variable. Git has a special reference, <strong>HEAD</strong>. This is a symbolic reference which points to the tip of the current branch, rather than an actual commit. If we have a branch called <strong>my-branch</strong> the reference would look like this: <strong>refs/head/my-branch</strong>.
The environment variable <strong>GITHUB_HEAD_REF_SLUG_URL</strong> contains a short value for <strong>HEAD</strong>, which is at the end the name of the branch <strong>my-branch</strong>. We can use this value as the name for the ResourceGroup, since this name is unique within our repository.
The following yaml snippet shows how to use the GitHub Slug action and how to assign the <strong>GITHUB_HEAD_REF_SLUG_URL</strong> environment variable to an environment variable <strong>ResourceGroupName</strong>:</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">env</span><span class="token punctuation">:</span>
  <span class="token key atrule">ResourceGroupName</span><span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span>
  <span class="token key atrule">ResourceGroupLocation</span><span class="token punctuation">:</span> <span class="token string">&quot;westeurope&quot;</span>
  <span class="token key atrule">StorageAccountPrefix</span><span class="token punctuation">:</span> <span class="token string">&quot;sta&quot;</span>

<span class="token key atrule">jobs</span><span class="token punctuation">:</span>
  <span class="token key atrule">deploy-from-main</span><span class="token punctuation">:</span>
    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest

    <span class="token key atrule">steps</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Inject slug/short variables
        <span class="token key atrule">uses</span><span class="token punctuation">:</span> rlespinasse/github<span class="token punctuation">-</span>slug<span class="token punctuation">-</span>action@v3.x

      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Set ResourceGroupName from slug/short
        <span class="token key atrule">run</span><span class="token punctuation">:</span> echo &quot;ResourceGroupName=$<span class="token punctuation">{</span><span class="token punctuation">{</span> env.GITHUB_HEAD_REF_SLUG_URL <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">-</span>rg&quot; <span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span> $GITHUB_ENV
</code></pre></div><p>Of course, we also need to make sure that all Azure resources that need a unique name get one. If we look at the ARM template, we see that a prefix parameter must be passed. With this prefix and the unique ID of the resource group a unique name for the storage account is created:</p> <div class="language-JSON extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;parameters&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;storageAccountPrefix&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;metadata&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;prefix to use for the storage account's name&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;variables&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;storageAccountName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;[concat(parameters('storageAccountPrefix'), take(uniqueString(resourceGroup().id), 4))]&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The ARM template can be found under the repository's root <a href="./templates/challenge_05/storage.json">/challenges/templates/challenge_05/storage.json</a>.</p> <h3 id="apply-labels-to-your-pull-request-to-control-the-workflow"><a href="#apply-labels-to-your-pull-request-to-control-the-workflow" class="header-anchor">#</a> Apply labels to your Pull Request to control the workflow</h3> <p>We now have the basis to either run a validation or build a staging environment and delete it again.
But how do we control whether a validation or the creation of a staging environment should be triggered?
The answer is GitHub labels.</p> <p>A workflow needs a trigger to be executed. As we want the workflow to be triggered only  within a Pull Request and if a label is applied, we use the Pull Request trigger and the type <strong>labeled</strong> as follow:</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">name</span><span class="token punctuation">:</span> PullRequest Validation

<span class="token key atrule">on</span><span class="token punctuation">:</span>
  <span class="token key atrule">pull_request</span><span class="token punctuation">:</span>
    <span class="token key atrule">types</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>labeled<span class="token punctuation">]</span>
</code></pre></div><p>By specifying this, the workflow will only be started if a pull request has been created and a label is applied.
Next, it is necessary to check within the definition which label has been set. Let's assume we have the following labels:</p> <ul><li><strong>validate</strong>: runs the what-if deployment</li> <li><strong>stage</strong>: deploys the changes to a staging environment</li> <li><strong>destroy</strong>: destroys the staging environment</li></ul> <p>Now we can check and decide which steps should be executed within the workflow based on the value of the label.</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">jobs</span><span class="token punctuation">:</span>
  <span class="token key atrule">deploy-from--main</span><span class="token punctuation">:</span>
    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest

    <span class="token key atrule">if</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
      (contains(github.event.pull_request.labels.*.name, 'validate') ||
      contains(github.event.pull_request.labels.*.name, 'stage')) &amp;&amp;
      !contains(github.event.pull_request.labels.*.name, 'destroy')</span>
    <span class="token key atrule">steps</span><span class="token punctuation">:</span>
    <span class="token punctuation">...</span>

  <span class="token key atrule">what-if-deployment</span><span class="token punctuation">:</span>
    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest
    <span class="token key atrule">needs</span><span class="token punctuation">:</span> deploy<span class="token punctuation">-</span>from<span class="token punctuation">-</span><span class="token punctuation">-</span>main

    <span class="token key atrule">if</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
      contains(github.event.pull_request.labels.*.name, 'validate') &amp;&amp;
      !contains(github.event.pull_request.labels.*.name, 'stage') &amp;&amp;
      !contains(github.event.pull_request.labels.*.name, 'destroy')</span>
    <span class="token key atrule">steps</span><span class="token punctuation">:</span>
    <span class="token punctuation">...</span>

  <span class="token key atrule">stage-deployment</span><span class="token punctuation">:</span>
    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest
    <span class="token key atrule">needs</span><span class="token punctuation">:</span> deploy<span class="token punctuation">-</span>from<span class="token punctuation">-</span><span class="token punctuation">-</span>main

    <span class="token key atrule">if</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
      contains(github.event.pull_request.labels.*.name, 'stage') &amp;&amp;
      !contains(github.event.pull_request.labels.*.name, 'destroy')</span>

    <span class="token key atrule">steps</span><span class="token punctuation">:</span>
    <span class="token punctuation">...</span>

  <span class="token key atrule">destroy-stage-deployment</span><span class="token punctuation">:</span>
    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest

    <span class="token key atrule">if</span><span class="token punctuation">:</span> contains(github.event.pull_request.labels.<span class="token important">*.name</span><span class="token punctuation">,</span> 'destroy')
    <span class="token key atrule">steps</span><span class="token punctuation">:</span>
    <span class="token punctuation">...</span>
</code></pre></div><h3 id="inspect-the-workflow-definition"><a href="#inspect-the-workflow-definition" class="header-anchor">#</a> Inspect the workflow definition</h3> <p>Don't worry, we don't want you to implement the workflow yourself now. The workflow is already there. Please take your time and have a close look at the definition before we see the workflow in action.
The workflow definition can be found in the repository's root directory under <a href="../.github/workflows/pr-validation.yml">.github/workflows/pr-validation.yml</a>.</p> <h2 id="see-the-workflow-in-action"><a href="#see-the-workflow-in-action" class="header-anchor">#</a> See the workflow in action</h2> <p>Now it's time to see the workflow for the described scenario in action.
First we need to create a new branch and make some changes to the code.</p> <p>Open a shell, navigate to the iac-basics-workshop folder, create a branch and check it out:</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">git</span> branch prvalidation
<span class="token function">git</span> checkout prvalidation
</code></pre></div><p>Rename the file <a href="./templates/challenge_05/storage.json__rename_me">/challenges/templates/challenge_05/storage.json__rename_me</a> to <strong>storage.json</strong>.</p> <p>Add and commit the changes:</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">git</span> <span class="token function">add</span> <span class="token builtin class-name">.</span>
<span class="token function">git</span> commit -m <span class="token string">&quot;see the workflow in action&quot;</span>
</code></pre></div><p>Next, push the branch to the remote repository:</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">git</span> push --set-upstream origin prvalidation
</code></pre></div><p>Now the branch is available in your remote repository. Open a browser, navigate to your iac-basics-workshop repository and click the <strong>Pull Request</strong> tab.
You will see that GitHub informs you that your branch <strong>prvalidation</strong> had recent pushes and thta the branch is ready to integrate by creating a Pull Request:</p> <p><img src="/iac-basics-workshop/assets/img/create-prvalidation-pr.c38ded18.png" alt="prvalidation-pullrequest"></p> <p>Click <strong>Compare &amp; pull request</strong> to open a Pull Request for your changes. If you like, you can leave a title and a comment for your pull request.
Take the time to see what information is already provided within the pull request.</p> <p><img src="/iac-basics-workshop/assets/img/open-prvalidation-pr.0d2fb668.png" alt="open-prvalidation-pr"></p> <p>Click <strong>Create pull request</strong> to create your Pull Request.</p> <p>After the Pull Request is created, we can trigger a what-if deployment. To trigger the deployment we need to apply the label <strong>validate</strong> to our Pull Request. In your open Pull Request, you can add a label in the right-hand side bar under <strong>Labels</strong>:</p> <p><img src="/iac-basics-workshop/assets/img/apply-label.a0cc15ab.png" alt="apply-label"></p> <p>Add the label validate. If you use the label validate for the first time, you have to create it:</p> <p><img src="/iac-basics-workshop/assets/img/apply-validate-label.9ce173b1.png" alt="apply-label-validate"></p> <p>After the label is applied it takes a few seconds until the workflow is triggered. Click on <strong>Details</strong> to see more information:</p> <p><img src="/iac-basics-workshop/assets/img/validate-pr-build.7f474ba9.png" alt="validate-pr-build"></p> <p>When the what-if deployment has run, we see the result in the pull request, which is stored as a comment. Based on this comment, we can discuss the possible changes in the team:</p> <p><img src="/iac-basics-workshop/assets/img/what-if-bot.b61db2eb.png" alt="what-if-bot"></p> <p>As a next step, we can add the label stage to deploy the changes in a temporary staging environment. We can use this environment to check the changes live:</p> <p><img src="/iac-basics-workshop/assets/img/apply-stage-label.9f26ba32.png" alt="apply-stage-label"></p> <p>After the label is applied it takes a few seconds until the workflow is triggered. Click on <strong>Details</strong> to see more information:</p> <p><img src="/iac-basics-workshop/assets/img/stage-build.2a367f5c.png" alt="stage-build"></p> <p>When the stage deployment has run, we see the result in the pull request, which is stored as a comment. The comment contains the name of the Resource Group where the staging environment is deployed:</p> <p><img src="/iac-basics-workshop/assets/img/stage-bot.c9b773de.png" alt="stage-bot"></p> <p>Navigate to your Azure subscription in the Azure portal and check if the resource group is there.</p> <p>As mentioned in the comment, we can delete the staging environment when we add the label destroy. Again, it takes a few seconds until the workflow is started:</p> <p><img src="/iac-basics-workshop/assets/img/apply-destroy-label.3614b558.png" alt="apply-destroy-label"></p> <h2 id="congratulations"><a href="#congratulations" class="header-anchor">#</a> Congratulations</h2> <p>You have seen how you can use a pull request and a GitHub workflow in an advanced scenario.</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/azuredevcollege/iac-basics-workshop/edit/master/challenges/challenge_05.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ‚Üê
      <a href="/iac-basics-workshop/challenges/challenge_04.html" class="prev">
        Create a GitHub Workflow to deploy an ARM Template
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/iac-basics-workshop/assets/js/app.4b7700f7.js" defer></script><script src="/iac-basics-workshop/assets/js/2.4b56f390.js" defer></script><script src="/iac-basics-workshop/assets/js/3.65a53ed6.js" defer></script>
  </body>
</html>
